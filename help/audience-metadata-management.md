---
description: Use audience metadata templates to programmatically create, update, or delete audiences (segments) in your destination platform.
title: Configuration options for credentials in Destination SDK
exl-id: 63ed9a03-eb4d-46c6-85e9-6c1d84acdbad
---
# Audience metadata management {#credentials}

>[!IMPORTANT]
>
>* The content on this page is Adobe confidential information, please do not share outside of your company.
>* The Adobe Experience Platform Destination SDK is currently an alpha release. The documentation and the functionality are subject to change.

**API endpoint**: `platform.adobe.io/data/core/activation/authoring/v1/audience-templates` 

Use audience metadata templates to programmatically create, update, or delete audiences (segments) in your destination. Based on the configuration of your API, you can use the audience metadata endpoint to create a template. After you define and test the template, it will be used by Adobe to structure the API calls to your destination.

## When to use the audience metadata management endpoint {#when-to-use}

Depending on your configuration, you may or may not need to use the audience metadata management API as you configure your destination. Use the decision tree diagram below to understand when to use the audience metadata endpoint.

![Whiteboard diagram](/help/assets/audience-metadata-decision-tree.png)

## Use cases supported by audience metadata management {#use-cases}

With audience metadata support in Destination SDK, when you configure your Experience Platform destination, you can give Experience Platform customers one of several options when they map and activate segments to your destination:

1. Require users to manually input segment mapping IDs in a destination instance.
2. Do not require users to input segment mapping IDs but I will include a template to indicate how my segment mapping ID will be returned in the audience creation API.
3. Do not require users to input segment mapping IDs. Experience Platform will pass in the segment ID generated by AEP as the segment ID in the destination system upon audience creation.
4. Do not require users to input segment mapping IDs. Experience Platform will pass in the segment name as the segment ID in the destination system upon audience creation.



### Use case 1 - require users to manually input mapping ID 

If "shell segments" and other metadata needs to be created by partners/customers manually, then customers have to manually fill in the "segment mapping ID" field in the activation workflow to sync the segment metadata between the two systems. 

![Input mapping ID](/help/assets/input-mapping-id.png) 

### Use case 2 - do not require users to manually input mapping ID

If the shell segment can be created programmatically (pre-requisite: you have an API endpoint to create/update/delete shell segments), you can configure Destination SDK to match the specs of your segment create/update/delete endpoint, and Experience Platform can programmatically create/update/delete segments and synchronize metadata back to Experience Platform.

### Use case 3 - your destination honors the Experience Platform segment ID 

If your destination system honors the Experience Platform segment ID space, you must configure a template. Customers do not have to populate "segment mapping ID" when activating a segment.

## Generic and extensible audience template {#generic-and-extensible}

To satisfy the use cases listed above, Adobe provides you with a generic template, that can be customized to adjust to your API specifications.

Select the Generic option when you [create a new audience template](/help/audience-metadata-management.md#create) if your API supports:

* The HTTP methods: POST, GET, PUT, DELETE, PATCH
* The authentication types OAuth 1, OAuth 2 with Bearer Token, OAuth 2 with client ID and client secret
* The functions: create audience, update audience, get audience, delete audience, validate credentials 

## Getting started with audience templates API operations

Before continuing, please review the [getting started guide](./getting-started.md) for important information that you need to know in order to successfully make calls to the API, including how to obtain required headers and how to get allowlisted.

## Create a new audience template {#create}

You can create a new audience template by making a POST request to the `/authoring/v1/audience-templates` endpoint.

**API format**


```http
POST /authoring/v1/audience-templates
```

**Request**

The following request creates a new audience metadata template, configured by the parameters provided in the payload.

```shell
curl -X POST https://platform.adobe.io/data/core/ups/export/jobs \
 -H 'Authorization: Bearer {ACCESS_TOKEN}' \
 -H 'Content-Type: application/json' \
 -H 'x-gw-ims-org-id: {IMS_ORG}' \
 -H 'x-api-key: {API_KEY}' \
 -H 'x-sandbox-name: {SANDBOX_NAME}' \
 -H 'x-sandbox-id: {SANDBOX_ID}' \
 -d '
{
  "audience": {
    "context": "string",
    "name": "string",
    "description": "string",
    "sid": "string",
    "account": "string",
    "accountType": "string",
    "externalAudienceId": "string",
    "imsOrgId": "string",
    "metadata": {
      "additionalProp1": "string"
    }
  },
  "credential": {
    "clientId": "string",
    "clientSecret": "string",
    "token": "string",
    "tokenSecret": "string",
    "refreshToken": "string",
    "developerToken": "string",
    "clientCustomerId": "string",
    "authType": "OAUTH1",
    "metadata": {
      "additionalProp1": "string"
    }
  },
  "metadataTemplate": {
    "name": "string",
    "host": "string",
    "create": {
      "uri": "string",
      "method": "string",
      "headers": {
        "additionalProp1": "string"
      },
      "params": {
        "additionalProp1": "string"
      },
      "body": {},
      "schemaMap": {
        "additionalProp1": "string"
      },
      "errorSchemaMap": {
        "additionalProp1": "string"
      }
    },
    "update": {
      "uri": "string",
      "method": "string",
      "headers": {
        "additionalProp1": "string"
      },
      "params": {
        "additionalProp1": "string"
      },
      "body": {},
      "schemaMap": {
        "additionalProp1": "string"
      },
      "errorSchemaMap": {
        "additionalProp1": "string"
      }
    },
    "delete": {
      "uri": "string",
      "method": "string",
      "headers": {
        "additionalProp1": "string",
      },
      "params": {
        "additionalProp1": "string",
      },
      "body": {},
      "schemaMap": {
        "additionalProp1": "string",
      },
      "errorSchemaMap": {
        "additionalProp1": "string",
      }
    },
    "validate": {
      "uri": "string",
      "method": "string",
      "headers": {
        "additionalProp1": "string",
      },
      "params": {
        "additionalProp1": "string",
      },
      "body": {},
      "schemaMap": {
        "additionalProp1": "string",
      },
      "errorSchemaMap": {
        "additionalProp1": "string",
      }
    }
  },
  "validations": [
    {
      "field": "string",
      "regex": "string"
    }
  ]
}'
```

| Property | Type | Description |
| -------- | ----------- | ----------- |
| `audience.context` | String | Use "context": "GENERIC" if your API satisfies the requirements in the [generic and extensible](/help/audience-metadata-management.md#generic-and-extensible) section. |
| `audience.description` | String | Use `"{{segment.description}}"` to pass the description of the Experience Platform segment to your API endpoint. | 
| `audience.name` | String | Use `"{{segment.name}}"` to pass the name of the Experience Platform segment to your API endpoint. | 
| `audience.sid` | String | Use `"{{segment.sid}}"` to pass the ID of the Experience Platform segment to your API endpoint. | 
| `audience.account` | String | Use `"{{audience.account}}"` to pass the user's account ID to your API endpoint.| 
| `audience.accountType` | String | If your destination supports several types of customer accounts, you can specify that here. | 
| `audience.externalAudienceId` | String | The segment or audience alias in your destination. | 
| `audience.imsOrgId` | String | The customer's Organization ID.  | 
| `audience.metadata.additionalProp1` | String | You can define any number of additional fields, specific to your destination. <br> For example, based on their [Marketing API documentation](https://developers.facebook.com/docs/marketing-api/audiences/guides/custom-audiences/), Facebook would add the field `"customer_file_source": "{{segment.metadata.customer_file_source}}"` to their destination configuration. | 
| `credential.clientId` | String |  |
| `credential.clientSecret` | String | | 
| `credential.token` | String | | 
| `credential.tokenSecret` | String | | 
| `credential.refreshToken` | String | | 
| `credential.developerToken` | String | | 
| `credential.clientCustomerId` | String | | 
| `credential.authType` | String | | 
| `credential.metadata.additionalProp1` | String | | 
| `metadataTemplate.name` | String | The name of the audience metadata template for your destination. |
| `metadataTemplate.host` | String | The URL of the API on your side. Two industry examples are: `https://ads-api.twitter.com/` and `https://graph.facebook.com/v10.0`. | 
| `metadataTemplate.create.uri` | String | The endpoint of your API, which is used for creating audiences/segments in your platform. | 
| `metadataTemplate.create.method` | String | The method used on your endpoint to programmatically create the segment/audience in your destination. Examples: `POST`, `PUT` | 
| `metadataTemplate.create.headers.additionalProp1` | String | Specifies any headers that should be added to the call to your API. For example, `"Content-Type": "application/x-www-form-urlencoded"` | 
| `metadataTemplate.create.params.additionalProp1` | String | Specifies any parameters that should be added to the body of the call to your API. | 
| `metadataTemplate.create.body` | String | Specifies the content of the message body that should be sent to your API. |
| `metadataTemplate.create.schemaMap.additionalProp1` | String |  | 
| `metadataTemplate.create.errorSchemaMap.additionalProp1` | String | | 
| `metadataTemplate.update.uri` | String | | 
| `metadataTemplate.update.method` | String | The method used on your endpoint to programmatically update the segment/audience in your destination. | 
| `metadataTemplate.update.headers.additionalProp1` | String | | 
| `metadataTemplate.update.params.additionalProp1` | String | | 
| `metadataTemplate.update.body` | String | | 
| `metadataTemplate.update.schemaMap.additionalProp1` | String | | 
| `metadataTemplate.update.errorSchemaMap.additionalProp1` | String | | 
| `metadataTemplate.delete.uri` | String | | 
| `metadataTemplate.delete.method` | String | The method used on your endpoint to programmatically delete the segment/audience in your destination. | 
| `metadataTemplate.delete.headers.additionalProp1` | String | | 
| `metadataTemplate.delete.params.additionalProp1` | String | | 
| `metadataTemplate.delete.body` | String | | 
| `metadataTemplate.delete.schemaMap.additionalProp1` | String | | 
| `metadataTemplate.delete.errorSchemaMap.additionalProp1` | String | | 
| `metadataTemplate.validate.uri` | String | | 
| `metadataTemplate.validate.method` | String | The method used on your endpoint to programmatically validate the segment/audience in your destination. | 
| `metadataTemplate.validate.headers.additionalProp1` | String | | 
| `metadataTemplate.validate.params.additionalProp1` | String | | 
| `metadataTemplate.validate.body` | String | | 
| `metadataTemplate.validate.schemaMap.additionalProp1` | String | | 
| `metadataTemplate.validate.errorSchemaMap.additionalProp1` | String | | 
| `validations.field` | String | | 
| `validations.regex` | String | | 



**Response**

A successful response returns HTTP status 200 with details of your newly created audience template.

## Update audience template {#update}

You can update an existing audience template by making a PUT request to the `/authoring/v1/audience-templates` endpoint and providing the instance ID of the audience template you want to update.

**API format**


```http
PUT /authoring/v1/audience-templates/{INSTANCE_ID}
```

| Parameter | Description |
| -------- | ----------- |
| {INSTANCE_ID} | The ID of the audience metadata template you want to update. |

**Request**

The following request updates the audience metadata template, configured by the parameters provided in the payload.

```json

{
    "instanceId": "a54b7a97-1a3b-40cf-8ae5-4dd635cd9a20",
    "createdDate": "2021-04-13T19:31:27.201228Z",
    "lastModifiedDate": "2021-04-21T12:44:43.739290Z",
    "audience": {
        "context": "Generic",
        "name": "{{segment.name}}",
        "description": "{{segment.description}}",
        "account": "{{targetConnection.params.accountId}}",
        "externalAudienceId": "{{segment.alias}}",
        "metadata": {
            "customer_file_source": "{{segment.metadata.customer_file_source}}"
        },
        "imsOrgId": "{{userContext.imsOrgId}}"
    },
    "credential": {
        "token": "{{baseConnection.auth.params.accessToken}}",
        "authType": "OAUTH2"
    },
    "metadataTemplate": {
        "create": {
            "uri": "/{{audience.account}}/segments?fields=name,description,account_id&subtype=CUSTOM",
            "method": "POST",
            "headers": {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            "params": {
                "name": "{{audience.name}}",
                "description": "{{audience.description}}",
                "access_token": "{{credential.token}}",
                "customer_file_source": "{{audience.metadata.customer_file_source}}"
            },
            "schemaMap": {
                "externalAudienceId": "{{response.id}}"
            },
            "errorSchemaMap": {
                "message": "error.message"
            }
        },
        "update": {
            "uri": "/{{audience.externalAudienceId}}",
            "method": "POST",
            "headers": {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            "params": {
                "name": "{{audience.name}}",
                "fields": "name,description,account_id",
                "description": "{{audience.description}}",
                "access_token": "{{credential.token}}",
                "customAudienceId": "{{audience.externalAudienceId}}",
                "customer_file_source": "{{audience.metadata.customer_file_source}}"
            },
            "schemaMap": {
                "externalAudienceId": "{{response.id}}"
            },
            "errorSchemaMap": {
                "message": "error.message"
            }
        },
        "delete": {
            "uri": "/{{audience.externalAudienceId}}",
            "method": "DELETE",
            "headers": {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            "params": {
                "fields": "name,description,account_id",
                "access_token": "{{credential.token}}",
                "customAudienceId": "{{audience.externalAudienceId}}"
            },
            "schemaMap": {
                "externalAudienceId": "{{response.id}}"
            },
            "errorSchemaMap": {
                "message": "error.message"
            }
        },
        "validate": {
            "uri": "/me/permissions?access_token={{credential.token}}",
            "method": "GET",
            "headers": {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            "schemaMap": {
                "Id": "{{response.id}}"
            },
            "errorSchemaMap": {
                "message": "error.message"
            }
        },
        "host": "https://api.moviestar.com/v1.0",
        "name": "Moviestar"
    },
    "validations": [
        {
            "field": "{{audience.account}}",
            "regex": "^moviestar_id_[0-9]+$"
        }
    ]
}

```

## Retrieve a list of audience templates {#retrieve-list}

You can retrieve a list of all audience templates for your IMS Organization by making a GET request to the `/authoring/v1/audience-templates` endpoint.

**API format**


```http
GET /authoring/v1/audience-templates
```

**Request**

The following request will retrieve the list of audience templates that you have access to, based on IMS Organization and sandbox configuration.

```shell
curl -X GET https://platform.adobe.io/data/core/activation/authoring/v1/audience-templates \
 -H 'Authorization: Bearer {ACCESS_TOKEN}' \
 -H 'x-gw-ims-org-id: {IMS_ORG}' \
 -H 'x-api-key: {API_KEY}' \
 -H 'x-sandbox-name: {SANDBOX_NAME}'
 -H 'x-sandbox-id: {SANDBOX_ID}'  
```

**Response**

The following response returns HTTP status 200 with a list of audience metadata templates that you have access to, based on the IMS Organization ID, sandbox name, and sandbox ID that you used. One `instanceId` corresponds to the template for one destination. The response is truncated for brevity. 

```json

[
    {
        "instanceId": "bd4ec8f0-e98f-4b6a-8064-dd7adbfffec6",
        "createdDate": "2021-04-13T19:33:09.733226Z",
        "lastModifiedDate": "2021-04-13T19:33:09.733226Z",
        "audience": {
            "context": "Generic",
            "name": "{{segment.name}}",
            "description": "{{segment.description}}",
            "account": "urn:li:sponsoredAccount:{{targetConnection.params.accountId}}",
            "externalAudienceId": "{{segment.alias}}",
            "imsOrgId": "{{userContext.imsOrgId}}"
        },
        "credential": {
            "token": "{{baseConnection.auth.params.accessToken}}",
            "authType": "OAUTH2"
        },
        "metadataTemplate": {
            "create": {
                "uri": "/v1/segments",
                "method": "POST",
                "headers": {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer {{credential.token}}"
                },
                "body": {
                    "name": "{{audience.name}}",
                    "type": "USER",
                    "account": "{{audience.account}}",
                    "accessPolicy": "PRIVATE",
                    "destinations": [
                        {
                            "destination": "Moviestar"
                        }
                    ],
                    "sourcePlatform": "ADOBE"
                },
                "schemaMap": {
                    "externalAudienceId": "{{headers.x-moviestar-id}}"
                },
                "errorSchemaMap": {
                    "message": "message"
                }
            },
            "update": {
                "uri": "/v1/segments/{{audience.id}}",
                "method": "POST",
                "headers": {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer {{credential.token}}"
                },
                "body": {
                    "patch": {
                        "$set": {
                            "name": "{{audience.name}}"
                        }
                    }
                },
                "errorSchemaMap": {
                    "message": "message"
                }
            },
            "delete": {
                "uri": "/v1/segments/{{audience.externalAudienceId}}",
                "method": "DELETE",
                "headers": {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer {{credential.token}}"
                },
                "body": {
                    "patch": {
                        "$set": {
                            "name": "{{audience.name}}"
                        }
                    }
                },
                "errorSchemaMap": {
                    "message": "message"
                }
            },
            "host": "https://api.moveistar.com",
            "name": "Moviestar audience template"
        }
    }
]
    
```



## Retrieve a specific audience template {#get}

You can retrieve detailed information about a specific audience template by making a GET request to the `/authoring/v1/audience-templates` endpoint and providing the instance ID of the audience template you want to update.

**API format**


```http
GET /authoring/v1/audience-templates/{INSTANCE_ID}
```

| Parameter | Description |
| -------- | ----------- |
| {INSTANCE_ID} | The ID of the audience metadata template you want to retrieve. |

**Request**

```shell
curl -X GET https://platform.adobe.io/data/core/activation/authoring/v1/audience-templates/13312423-23wadwdxw-12cdwc-e2qc \
 -H 'Authorization: Bearer {ACCESS_TOKEN}' \
 -H 'x-gw-ims-org-id: {IMS_ORG}' \
 -H 'x-api-key: {API_KEY}' \
 -H 'x-sandbox-name: {SANDBOX_NAME}'
 -H 'x-sandbox-id: {SANDBOX_ID}'
```

**Response**

A successful response returns HTTP status 200 with detailed information about the specified audience template.

```json
{
    "instanceId": "cbf90a70-96b4-437b-86be-522fbdaabe9c",
    "createdDate": "2021-04-15T20:40:39.500796Z",
    "lastModifiedDate": "2021-04-15T20:40:39.500796Z",
    "audience": {
        "context": "Generic",
        "name": "{{segment.name}}",
        "account": "{{targetConnection.params.accountId}}",
        "externalAudienceId": "{{segment.alias}}"
    },
    "credential": {
        "clientId": "{{authentication.oauth1Authentication.apiKey}}",
        "clientSecret": "{{authentication.oauth1Authentication.apiSecret}}",
        "token": "{{baseConnection.auth.params.accessToken}}",
        "tokenSecret": "{{baseConnection.auth.params.tokenSecret}}",
        "authType": "OAUTH1"
    },
    "metadataTemplate": {
        "create": {
            "uri": "/accounts/{{audience.account}}/tailored_audiences?name={{audience.name}}",
            "method": "POST",
            "headers": {
                "Content-Type": "application/json"
            },
            "schemaMap": {
                "externalAudienceId": "{{response.data.id}}"
            },
            "errorSchemaMap": {
                "message": "errors[0].message"
            }
        },
        "update": {
            "uri": "/accounts/{{audience.account}}/tailored_audiences/{{audience.externalAudienceId}}?name={{audience.name}}",
            "method": "PUT",
            "headers": {
                "Content-Type": "application/json"
            },
            "errorSchemaMap": {
                "message": "errors[0].message"
            }
        },
        "delete": {
            "uri": "/accounts/{{audience.account}}/tailored_audiences/{{audience.externalAudienceId}}",
            "method": "DELETE",
            "headers": {
                "Content-Type": "application/json"
            },
            "errorSchemaMap": {
                "message": "errors[0].message"
            }
        },
        "host": "https://ads-api.twitter.com/8"
    }
}
```


## Delete a specific audience template {#delete}

You can request to delete the specified audience template by making a DELETE request to the `/authoring/v1/audience-templates` endpoint and providing the ID of the audience template you wish to delete in the request path.

**API format**

```http
DELETE /authoring/v1/audience-templates/{INSTANCE_ID}
```

| Parameter | Description |
| --------- | ----------- |
| `{INSTANCE_ID}` | The `id` of the audience template you want to delete. |

**Request**

```shell
curl -X DELETE https://platform.adobe.io/data/core/activation/authoring/v1/audience-templates/{DESTINATION_ID} \
 -H 'Authorization: Bearer {ACCESS_TOKEN}' \
 -H 'x-gw-ims-org-id: {IMS_ORG}' \
 -H 'x-api-key: {API_KEY}' \
 -H 'x-sandbox-name: {SANDBOX_NAME}' \
 -H 'x-sandbox-id: {SANDBOX_ID}'
```

**Response**

A successful response returns HTTP status 204 with the following message:

```json
{
  "status": true,
  "message": ""
}
```

## Template examples

This section includes some example templates, for your reference. They all use a fictional destination, called Moviestar.

```

{
  "name": "Moviestar",
  "host": "https://api.moviestar.com",
  "get": {
    "uri": "/v2/segments/{{audience.id}}",
    "method": "GET",
    "headers": {
      "Authorization": "Bearer {{credential.token}}"
    },
    "schemaMap": {
      "externalAudienceId": "{{response.id}}",
      "name": "{{response.name}}",
      "account": "{{response.account}}"
    }
  },
  "create": {
    "uri": "/v2/segments",
    "method": "POST",
    "headers": {
      "Authorization": "Bearer {{credential.token}}",
      "Content-Type": "application/json"
    },
    "body": {
      "name": "{{audience.name}}",
      "sourcePlatform": "ADOBE",
      "account": "{{audience.account}}",
      "accessPolicy": "PRIVATE",
      "type": "USER",
      "destinations": [{
        "destination": "Moviestar"
      }]
    },
    "schemaMap": {
      "externalAudienceId": "{{headers.x-moviestar-id}}"
    },
    "errorSchemaMap": {
      "message": "message"
    }
  },
  "update": {
    "uri": "/v2/segments/{{audience.externalAudienceId}}",
    "method": "POST",
    "headers": {
      "Authorization": "Bearer {{credential.token}}",
      "Content-Type": "application/json"
    },
    "body": {
      "patch": {
        "$set": {
          "name": "{{audience.name}}"
        }
      }
    },
    "errorSchemaMap": {
      "message": "message"
    }
  },
  "delete": {
    "uri": "/v2/segments/{{audience.externalAudienceId}}",
    "method": "DELETE",
    "headers": {
      "Authorization": "Bearer {{credential.token}}",
      "Content-Type": "application/json"
    ,
    "errorSchemaMap": {
      "message": "message"
    }
  },
  "validate": {
    "uri": "/v2/validate",
    "method": "GET",
    "headers": {
      "Authorization": "Bearer {{credential.token}}",
      "Content-Type": "application/json"
    },
    "schemaMap": {
      "Id": "{{response.id}}"
    },
    "errorSchemaMap": {
      "message": "message"
    }
  }
  }
}

```

## Next steps

After reading this guide, you now know when to use audience metadata templates and how to configure an audience metadata template using the `/authoring/v1/audience-templates` API endpoint.